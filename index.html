<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Camera selection</title>
    <link rel="stylesheet" href="./app.css" />

</head>

<body>

    <main id="app">

        <video id="video" autoplay playsinline style="border:2px solid red"></video>

        <button id="button1" @click="button1">Button 1</button>
        <button id="button2" @click="button2">Button 2</button>
        <div v-html="log"></div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>

    <script>
        const video = document.getElementById('video');

        const button1 = document.getElementById('button1');
        const button2 = document.getElementById('button2');
        let currentStream;

        const vm = new Vue({
            data: {
                log: ''
            },
            el: '#app',
            methods: {
                button1() {

                    if (typeof currentStream !== 'undefined') {
                        stopMediaTracks(currentStream);
                        this.log += 'Log 1:' + currentStream.toString() + '<br>';
                    }

                    const videoConstraints = {};

                    if (true) {
                        this.log += 'Log 2:TRUE <br>';
                        videoConstraints.facingMode = 'environment';
                    } else {
                        videoConstraints.deviceId = {
                            exact: select.value
                        };
                    }

                    const constraints = {
                        video: videoConstraints,
                        audio: false
                    };

                    navigator.mediaDevices
                        .getUserMedia(constraints)
                        .then(stream => {
                            currentStream = stream;
                            video.srcObject = stream;
                            return navigator.mediaDevices.enumerateDevices();
                        })
                        .then(gotDevices)
                        .catch(error => {
                            console.error(error);
                        });
                },

                button2() {
                    alert('b')
                }
            }
        });


        function stopMediaTracks(stream) {
            stream.getTracks().forEach(track => {
                track.stop();
            });
        }

        function gotDevices(mediaDevices) {

            let count = 1;

            mediaDevices.forEach(mediaDevice => {
                if (mediaDevice.kind === 'videoinput') {
                    console.log();
                    vm.log += mediaDevice.deviceId + "<br>";
                    const label = mediaDevice.label || `Camera ${count++}`;
                    button1.value = mediaDevice.deviceId + '' + label;
                }
            });
        }


        navigator.mediaDevices.enumerateDevices().then(gotDevices);
    </script>
</body>

</html>