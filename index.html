<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Camera selection</title>
    <link rel="stylesheet" href="./app.css" />

</head>

<body>

    <main>
        <div class="controls">
            <button id="button">Get camera</button>
            <select id="select">
                <option></option>
            </select>
        </div>

        <video id="video" autoplay playsinline></video>

        <button id="button1">Button 1</button>
        <button id="button2">Button 2</button>
    </main>

    <footer>
        <p>Built by
            <a href="https://twitter.com/philnash">@philnash</a>
        </p>
    </footer>

    <script>
        const video = document.getElementById('video');
        const button = document.getElementById('button');

        const button1 = document.getElementById('button1');
        const button2 = document.getElementById('button2');

        const select = document.getElementById('select');
        let currentStream;

        function stopMediaTracks(stream) {
            stream.getTracks().forEach(track => {
                track.stop();
            });
        }

        function gotDevices(mediaDevices) {
            select.innerHTML = '';

            select.appendChild(document.createElement('option'));

            let count = 1;

            mediaDevices.forEach(mediaDevice => {
                if (mediaDevice.kind === 'videoinput') {
                    button1.value = mediaDevice.deviceId;
                    const label = mediaDevice.label || `Camera ${count++}`;
                }
            });
        }

        button.addEventListener('click', event => {

            if (typeof currentStream !== 'undefined') {
                stopMediaTracks(currentStream);
            }

            const videoConstraints = {};

            if (select.value === '') {
                videoConstraints.facingMode = 'environment';
            } else {
                videoConstraints.deviceId = {
                    exact: select.value
                };
            }
            const constraints = {
                video: videoConstraints,
                audio: false
            };
            navigator.mediaDevices
                .getUserMedia(constraints)
                .then(stream => {
                    currentStream = stream;
                    video.srcObject = stream;
                    return navigator.mediaDevices.enumerateDevices();
                })
                .then(gotDevices)
                .catch(error => {
                    console.error(error);
                });
        });

        navigator.mediaDevices.enumerateDevices().then(gotDevices);
    </script>
</body>

</html>